server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true

spring:
  application:
    name: CryptoRate

  # 数据源配置
  datasource:
    # 数据库连接 URL
    url: jdbc:mysql://localhost:3306/cryptorate?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
    username: root
    password: 148017805  # 生产环境建议使用环境变量: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
    
    # HikariCP 连接池配置（Spring Boot 3 默认）
    hikari:
      # 连接池名称
      pool-name: CryptoRateHikariPool
      # 最小空闲连接数
      minimum-idle: 5
      # 最大连接数
      maximum-pool-size: 20
      # 连接超时时间（毫秒）
      connection-timeout: 30000
      # 空闲连接最大存活时间（毫秒）
      idle-timeout: 600000
      # 连接最大存活时间（毫秒）
      max-lifetime: 1800000
      # 连接测试查询
      connection-test-query: SELECT 1

  # Jackson 配置
  jackson:
    # 日期格式
    date-format: yyyy-MM-dd HH:mm:ss
    # 时区
    time-zone: GMT+8
    # 序列化配置
    serialization:
      # 格式化输出
      indent-output: true
      # 忽略空对象
      fail-on-empty-beans: false
    # 反序列化配置
    deserialization:
      # 忽略未知属性
      fail-on-unknown-properties: false

# MyBatis 配置
mybatis:
  # Mapper XML 文件位置
  mapper-locations: classpath:mapper/*.xml
  # 实体类别名包路径
  type-aliases-package: com.cryptorate.entity
  # MyBatis 配置
  configuration:
    # 开启驼峰命名转换：Table(user_name) -> Entity(userName)
    map-underscore-to-camel-case: true
    # 开启延迟加载
    lazy-loading-enabled: true
    # 开启二级缓存
    cache-enabled: true
    # 日志实现
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

# Coinlayer API 配置
coinlayer:
  # API 访问密钥（生产环境建议使用环境变量: ${COINLAYER_API_KEY}）
  access-key: 3b4fb0d39af519933feb7c0fe5bc2472
  # API 基础 URL
  base-url: http://api.coinlayer.com
  # 默认目标货币
  target: USD
  # 请求超时时间（秒）
  timeout: 5

# 定时任务配置
# ★ 修改采集频率只需改下面的 rate-sync-interval-ms，单位：毫秒
# 免费套餐限制：每月 100 次调用
#   每 24 小时 = 约 30 次/月  ✓ 推荐
#   每  6 小时 = 约 120 次/月 ✗ 超限
#   每  1 小时 = 约 720 次/月 ✗ 超限
#
# ★★★ 遇到 429 / API 额度用尽时，把 enabled 改为 false 即可完全禁用定时同步 ★★★
scheduler:
  # 是否启用定时同步（true=启用  false=禁用，可避免 429）
  enabled: false
  # 首次执行延迟：程序启动后等待 30 秒再执行，单位毫秒
  initial-delay-ms: 30000
  # 采集间隔：默认 24 小时（86400000 毫秒）
  rate-sync-interval-ms: 86400000

# 日志配置
logging:
  level:
    # 根日志级别
    root: INFO
    # 项目日志级别
    com.cryptorate: DEBUG
    # MyBatis 日志级别
    com.cryptorate.mapper: DEBUG
    # OkHttp 日志级别（需要开启 HttpLoggingInterceptor）
    okhttp3: DEBUG
  # 日志输出格式
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  # 日志文件配置
  file:
    name: logs/cryptorate.log
    max-size: 10MB
    max-history: 30
