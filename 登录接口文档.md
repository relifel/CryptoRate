# 后端登录与注册接口文档

本文档说明 CryptoRate 后端提供的**用户登录接口**与**用户注册接口**的请求格式、响应格式、错误码及实现位置。

---

## 一、登录接口

### 1.1 接口概览

| 项目 | 说明 |
|------|------|
| 接口名称 | 用户登录 |
| 请求方法 | `POST` |
| 接口路径 | `/user/login` |
| 完整 URL | `http://localhost:8080/user/login`（以实际部署为准） |
| Content-Type | `application/json` |
| 认证要求 | 无需携带 Token（登录接口本身用于获取身份） |

### 1.2 请求说明

请求体为 JSON：

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | string | 是 | 用户名，前后空格会被自动去除 |
| password | string | 是 | 密码（当前明文校验，生产环境建议 BCrypt 等加密） |

**示例：**

```json
{
  "username": "testuser",
  "password": "123456"
}
```

**参数校验：**

- 若请求体为 `null`，或缺少 `username`、`password` 任一字段，返回 **400**，`msg` 为「请输入用户名和密码」。
- `username` 会在服务端执行 `trim()`，再参与查询与校验。

### 1.3 响应说明

**成功（code = 200）：**

```json
{
  "code": 200,
  "msg": "登录成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "createdAt": "2026-02-13 10:30:00"
  },
  "timestamp": 1705924800000
}
```

**data 字段说明：** id（用户 ID）、username（用户名）、email（邮箱，可为空）、createdAt（注册时间）。响应中 **不包含** password。

**失败：**

| code | 场景 | msg 示例 |
|------|------|----------|
| 400 | 请求体为空或缺少 username/password | 请输入用户名和密码 |
| 401 | 用户名不存在或密码错误 | 用户名或密码错误 |

### 1.4 业务逻辑简述

1. **Controller**（`UserController.login`）接收 `POST /user/login`，校验请求体非空且包含 `username`、`password`，不通过则返回 400。
2. **Service**（`UserService.login`）根据 `username` 查询用户；若不存在或密码不匹配，抛出 `ApiException(401, "用户名或密码错误")`，由全局异常处理器返回 401。
3. 校验通过后，将用户对象中的 `password` 置为 `null`，再通过 `R.ok("登录成功", user)` 返回 200 及用户信息。

### 1.5 调用示例

```bash
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"123456"}'
```

---

## 二、注册接口

### 2.1 接口概览

| 项目 | 说明 |
|------|------|
| 接口名称 | 用户注册 |
| 请求方法 | `POST` |
| 接口路径 | `/user/register` |
| 完整 URL | `http://localhost:8080/user/register`（以实际部署为准） |
| Content-Type | `application/json` |
| 认证要求 | 无需携带 Token |

### 2.2 请求说明

请求体为 JSON：

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | string | 是 | 用户名（唯一），前后空格会被自动去除 |
| password | string | 是 | 密码（当前明文存储，生产环境建议 BCrypt 等加密） |
| email | string | 否 | 邮箱 |

**示例：**

```json
{
  "username": "newuser",
  "password": "123456",
  "email": "newuser@example.com"
}
```

**参数校验：**

- 若请求体为 `null`，或 `username`、`password` 为空/未传，返回 **400**，`msg` 为「请输入用户名和密码」。
- **Service 层**：若 `username` 去空格后为空，抛出 `ApiException(400, "请输入用户名")`；若 `password` 为空，抛出 `ApiException(400, "请输入密码")`；若用户名已存在，抛出 `ApiException(400, "用户名已存在")`。

### 2.3 响应说明

**成功（code = 200）：**

```json
{
  "code": 200,
  "msg": "注册成功",
  "data": {
    "id": 2,
    "username": "newuser",
    "email": "newuser@example.com",
    "createdAt": "2026-02-13 11:00:00"
  },
  "timestamp": 1705924800000
}
```

**data 字段说明：** id（用户 ID）、username（用户名）、email（邮箱，可为空）、createdAt（注册时间）。响应中 **不包含** password。

**失败：**

| code | 场景 | msg 示例 |
|------|------|----------|
| 400 | 未传或空 username/password、用户名已存在 | 请输入用户名和密码 / 请输入用户名 / 请输入密码 / 用户名已存在 |
| 500 | 数据库插入失败等 | 用户注册失败 |

### 2.4 业务逻辑简述

1. **Controller**（`UserController.register`）接收 `POST /user/register`，校验请求体非空且 `username`、`password` 非空，不通过则返回 400。
2. **Service**（`UserService.register`）对 `username` 去空格并校验非空、校验 `password` 非空；若 `userMapper.existsByUsername(username)` 为 true，抛出 `ApiException(400, "用户名已存在")`；设置 `createdAt` 后调用 `userMapper.insert(user)`；插入失败则抛出 `ApiException(500, "用户注册失败")`。
3. 注册成功后，将用户对象中的 `password` 置为 `null`，再通过 `R.ok("注册成功", user)` 返回 200 及新用户信息。

### 2.5 调用示例

```bash
curl -X POST http://localhost:8080/user/register \
  -H "Content-Type: application/json" \
  -d '{"username":"newuser","password":"123456","email":"newuser@example.com"}'
```

---

## 三、代码位置

| 接口 | 层级 | 类 / 方法 | 文件路径 |
|------|------|-----------|----------|
| 登录 | 控制器 | `UserController#login` | `controller/UserController.java` |
| 登录 | 服务层 | `UserService#login` | `service/UserService.java` |
| 注册 | 控制器 | `UserController#register` | `controller/UserController.java` |
| 注册 | 服务层 | `UserService#register` | `service/UserService.java` |
| 通用 | 数据层 | `UserMapper#selectByUsername`、`existsByUsername`、`insert` | `mapper/UserMapper.java` |
| 通用 | 实体 | `User` | `entity/User.java` |
| 通用 | 统一响应 | `R<T>` | `common/R.java` |
| 通用 | 异常 | `ApiException`、`GlobalExceptionHandler` | `common/exception/` |

---

## 四、安全与扩展说明

- **当前实现**：密码为明文存储与比对，仅适合开发/演示环境。
- **生产建议**：使用 BCrypt 等算法对密码加密存储；注册时 `passwordEncoder.encode(rawPassword)`，登录时 `passwordEncoder.matches(rawPassword, encodedPassword)`；必要时可增加登录/注册失败次数限制、验证码等。
- **Token 扩展**：若需前后端分离下的会话保持，可在登录/注册成功后生成 JWT 或 Session Token，放入响应 `data` 或响应头，由前端在后续请求中携带（如 `Authorization: Bearer <token>`），后端再增加 Filter/Interceptor 校验。

---

## 五、相关文档

- 前端登录与注册、拦截器说明：见前端项目中的 **登录接口与拦截器说明.md**
- 全量 API 列表与测试：见 **API接口文档与测试指南.md**
