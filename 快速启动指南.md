# CryptoRate å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸ¯ é¡¹ç›®å·²å®Œæˆæ­å»ºï¼

æ­å–œï¼ä½ çš„ **CryptoRate åŠ å¯†è´§å¸è¿½è¸ªç³»ç»Ÿ**å·²ç»æ­å»ºå®Œæˆã€‚æœ¬æ–‡æ¡£å¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨å’Œæµ‹è¯•é¡¹ç›®ã€‚

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
CryptoRate/
â”œâ”€â”€ pom.xml                                 # Maven é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md                               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ API_TEST.md                             # API æµ‹è¯•æ–‡æ¡£
â”œâ”€â”€ å¿«é€Ÿå¯åŠ¨æŒ‡å—.md                         # æœ¬æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/cryptorate/
â”‚   â”‚   â”‚   â”œâ”€â”€ CryptoRateApplication.java # å¯åŠ¨ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ common/                    # å…¬å…±æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ R.java                 # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ exception/             # å¼‚å¸¸å¤„ç†
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ApiException.java
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ GlobalExceptionHandler.java
â”‚   â”‚   â”‚   â”œâ”€â”€ config/                    # é…ç½®ç±»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OkHttpConfig.java      # OkHttp é…ç½®ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CoinlayerConfig.java   # Coinlayer API é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/                # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MarketController.java  # å¸‚åœºæ•°æ®æ¥å£
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserController.java    # ç”¨æˆ·ç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ service/                   # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CryptoMarketService.java # åŠ å¯†è´§å¸æœåŠ¡ï¼ˆOkHttp å®ç°ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserService.java       # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/                    # MyBatis Mapper
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserMapper.java
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/                    # å®ä½“ç±»
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ User.java
â”‚   â”‚   â”‚   â””â”€â”€ dto/                       # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚       â””â”€â”€ CoinlayerResponse.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml            # åº”ç”¨é…ç½®
â”‚   â”‚       â”œâ”€â”€ mapper/                    # MyBatis XML
â”‚   â”‚       â”‚   â””â”€â”€ UserMapper.xml
â”‚   â”‚       â””â”€â”€ sql/
â”‚   â”‚           â””â”€â”€ init.sql               # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ test/
â””â”€â”€ target/                                 # ç¼–è¯‘è¾“å‡ºç›®å½•
```

---

## ğŸš€ å¯åŠ¨æ­¥éª¤ï¼ˆ5 åˆ†é’Ÿæå®šï¼‰

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

ç¡®ä¿ä½ å·²ç»å®‰è£…ï¼š

- âœ… **JDK 17** æˆ–æ›´é«˜ç‰ˆæœ¬
- âœ… **Maven 3.6+**
- âœ… **MySQL 8.0+**

æ£€æŸ¥ç‰ˆæœ¬ï¼š

```bash
java -version   # åº”è¯¥æ˜¾ç¤º 17 æˆ–æ›´é«˜
mvn -version    # åº”è¯¥æ˜¾ç¤º 3.6 æˆ–æ›´é«˜
mysql --version # åº”è¯¥æ˜¾ç¤º 8.0 æˆ–æ›´é«˜
```

---

### æ­¥éª¤ 2: åˆå§‹åŒ–æ•°æ®åº“

æ‰“å¼€å‘½ä»¤è¡Œï¼Œç™»å½• MySQLï¼š

```bash
mysql -u root -p
```

æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š

```sql
SOURCE src/main/resources/sql/init.sql;
```

æˆ–è€…æ‰‹åŠ¨å¤åˆ¶ `src/main/resources/sql/init.sql` çš„å†…å®¹æ‰§è¡Œã€‚

éªŒè¯æ•°æ®åº“ï¼š

```sql
USE cryptorate;
SHOW TABLES;
SELECT * FROM user;
```

åº”è¯¥çœ‹åˆ° 4 ä¸ªæµ‹è¯•ç”¨æˆ·æ•°æ®ã€‚

---

### æ­¥éª¤ 3: é…ç½® API Key

#### 3.1 è·å– Coinlayer API Key

1. è®¿é—® [Coinlayer å®˜ç½‘](https://coinlayer.com/)
2. ç‚¹å‡» "Get Free API Key"
3. æ³¨å†Œå¹¶è·å–å…è´¹ API Keyï¼ˆå…è´¹ç‰ˆæ¯æœˆ 100 æ¬¡è¯·æ±‚ï¼‰

#### 3.2 ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `src/main/resources/application.yml`ï¼š

```yaml
# ä¿®æ”¹æ•°æ®åº“å¯†ç ï¼ˆç¬¬ 18 è¡Œï¼‰
spring:
  datasource:
    password: ä½ çš„MySQLå¯†ç   # æ”¹æˆä½ çš„å®é™…å¯†ç 

# é…ç½® Coinlayer API Keyï¼ˆç¬¬ 68 è¡Œï¼‰
coinlayer:
  access-key: ä½ çš„Coinlayer_API_Key  # æ›¿æ¢æˆä½ çš„ API Key
```

---

### æ­¥éª¤ 4: å¯åŠ¨é¡¹ç›®

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š

```bash
# æ–¹å¼ 1: Maven ç›´æ¥è¿è¡Œ
mvn spring-boot:run
```

æˆ–è€…å…ˆæ‰“åŒ…å†è¿è¡Œï¼š

```bash
# æ–¹å¼ 2: æ‰“åŒ…åè¿è¡Œ
mvn clean package
java -jar target/CryptoRate-1.0-SNAPSHOT.jar
```

å¯åŠ¨æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
=================================================
     CryptoRate åŠ å¯†è´§å¸è¿½è¸ªç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼
     è®¿é—®åœ°å€: http://localhost:8080
=================================================
```

---

### æ­¥éª¤ 5: æµ‹è¯•æ¥å£

#### æ–¹å¼ 1: ä½¿ç”¨æµè§ˆå™¨

ç›´æ¥åœ¨æµè§ˆå™¨è®¿é—®ï¼š

```
http://localhost:8080/market/rates
http://localhost:8080/user/1
```

#### æ–¹å¼ 2: ä½¿ç”¨ curl

```bash
# æµ‹è¯•è·å–åŠ å¯†è´§å¸æ±‡ç‡
curl http://localhost:8080/market/rates

# æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯
curl http://localhost:8080/user/1

# æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:8080/user/register \
  -H "Content-Type: application/json" \
  -d '{"username":"myuser","password":"123456","email":"my@example.com"}'
```

---

## ğŸ“– æ ¸å¿ƒåŠŸèƒ½è¯´æ˜

### 1ï¸âƒ£ OkHttp 4 é›†æˆï¼ˆé‡ç‚¹ï¼‰

é¡¹ç›®ä½¿ç”¨ **OkHttp 4** ä½œä¸º HTTP å®¢æˆ·ç«¯ï¼Œé…ç½®æ–‡ä»¶åœ¨ï¼š

```
src/main/java/com/cryptorate/config/OkHttpConfig.java
```

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ… è¿æ¥æ± ç®¡ç†ï¼ˆ200 ä¸ªç©ºé—²è¿æ¥ï¼Œä¿æŒ 5 åˆ†é’Ÿï¼‰
- âœ… è¶…æ—¶é…ç½®ï¼ˆè¿æ¥/è¯»/å†™ å‡ 5 ç§’ï¼‰
- âœ… æ—¥å¿—æ‹¦æˆªå™¨ï¼ˆæ‰“å°å®Œæ•´è¯·æ±‚/å“åº”ï¼‰
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶

**ä½¿ç”¨ç¤ºä¾‹**ï¼šæŸ¥çœ‹ `CryptoMarketService.java` çš„ `getRealTimeRates()` æ–¹æ³•ã€‚

---

### 2ï¸âƒ£ Coinlayer API é›†æˆ

æœåŠ¡ç±»ï¼š`src/main/java/com/cryptorate/service/CryptoMarketService.java`

**æ ¸å¿ƒæ­¥éª¤**ï¼š
1. æ„å»ºå¸¦ API Key çš„è¯·æ±‚ URL
2. åˆ›å»º OkHttp Request å¯¹è±¡
3. ä½¿ç”¨ **try-with-resources** æ‰§è¡Œè¯·æ±‚ï¼ˆè‡ªåŠ¨å…³é—­ Responseï¼‰
4. æ£€æŸ¥ HTTP çŠ¶æ€ç 
5. è¯»å–å“åº” Body
6. ä½¿ç”¨ Jackson ååºåˆ—åŒ– JSON
7. éªŒè¯ä¸šåŠ¡æˆåŠŸæ ‡è¯†
8. è¿”å›æ•°æ®

**æ¥å£**ï¼š
- `GET /market/rates` - è·å–æ‰€æœ‰åŠ å¯†è´§å¸æ±‡ç‡
- `GET /market/rate/{symbol}` - è·å–æŒ‡å®šè´§å¸æ±‡ç‡ï¼ˆå¦‚ BTCã€ETHï¼‰

---

### 3ï¸âƒ£ ç”¨æˆ·ç®¡ç†æ¨¡å—

æä¾›å®Œæ•´çš„ CRUD æ“ä½œï¼š

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/user/register` | POST | ç”¨æˆ·æ³¨å†Œ |
| `/user/{id}` | GET | æ ¹æ® ID æŸ¥è¯¢ç”¨æˆ· |
| `/user/username/{username}` | GET | æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ |
| `/user/{id}` | PUT | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| `/user/{id}` | DELETE | åˆ é™¤ç”¨æˆ· |

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨æ—¶æŠ¥ "ç«¯å£è¢«å ç”¨"

**è§£å†³æ–¹æ¡ˆ**ï¼šä¿®æ”¹ `application.yml` ä¸­çš„ç«¯å£å·

```yaml
server:
  port: 8081  # æ”¹æˆå…¶ä»–ç«¯å£
```

---

### Q2: è¿æ¥æ•°æ®åº“å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`Access denied for user 'root'@'localhost'`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ MySQL æ˜¯å¦å¯åŠ¨
2. ç¡®è®¤ `application.yml` ä¸­çš„ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®
3. ç¡®ä¿æ•°æ®åº“ `cryptorate` å·²åˆ›å»º

---

### Q3: Coinlayer API è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`Coinlayer API é”™è¯¯: [101] Invalid API Key`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤å·²åœ¨ [Coinlayer å®˜ç½‘](https://coinlayer.com/) æ³¨å†Œå¹¶è·å– API Key
2. æ£€æŸ¥ `application.yml` ä¸­çš„ `coinlayer.access-key` é…ç½®æ˜¯å¦æ­£ç¡®
3. å…è´¹ç‰ˆæœ‰è°ƒç”¨æ¬¡æ•°é™åˆ¶ï¼ˆæ¯æœˆ 100 æ¬¡ï¼‰

---

### Q4: Maven ä¾èµ–ä¸‹è½½æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼šé…ç½®å›½å†…é•œåƒ

ç¼–è¾‘ `~/.m2/settings.xml`ï¼ˆå¦‚æœæ²¡æœ‰å°±åˆ›å»ºï¼‰ï¼š

```xml
<mirrors>
  <mirror>
    <id>aliyun</id>
    <mirrorOf>central</mirrorOf>
    <url>https://maven.aliyun.com/repository/public</url>
  </mirror>
</mirrors>
```

---

## ğŸ“š å­¦ä¹ èµ„æ–™

### OkHttp å®˜æ–¹æ–‡æ¡£

- [OkHttp GitHub](https://github.com/square/okhttp)
- [OkHttp å®˜æ–¹æ–‡æ¡£](https://square.github.io/okhttp/)

### Spring Boot 3 æ–‡æ¡£

- [Spring Boot å®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)

### MyBatis æ–‡æ¡£

- [MyBatis ä¸­æ–‡æ–‡æ¡£](https://mybatis.org/mybatis-3/zh/index.html)

---

## ğŸ“ ä»£ç äº®ç‚¹

### 1. å®Œå–„çš„ OkHttp ä½¿ç”¨ç¤ºä¾‹

æŸ¥çœ‹ `CryptoMarketService.java`ï¼š

```java
// ä½¿ç”¨ try-with-resources ç¡®ä¿ Response è‡ªåŠ¨å…³é—­
try (Response response = okHttpClient.newCall(request).execute()) {
    if (!response.isSuccessful()) {
        throw new ApiException(response.code(), "HTTP è¯·æ±‚å¤±è´¥");
    }
    
    // ç©ºæŒ‡é’ˆæ£€æŸ¥
    if (response.body() == null) {
        throw new ApiException("å“åº” Body ä¸ºç©º");
    }
    
    // è¯»å–å¹¶è§£æ JSON
    String jsonBody = response.body().string();
    CoinlayerResponse result = objectMapper.readValue(jsonBody, CoinlayerResponse.class);
    
    return result.getRates();
} catch (IOException e) {
    throw new ApiException("è°ƒç”¨ API å¤±è´¥: " + e.getMessage(), e);
}
```

### 2. ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰æ¥å£è¿”å›ç»Ÿä¸€çš„ `R<T>` æ ¼å¼ï¼š

```json
{
  "code": 200,
  "msg": "success",
  "data": { ... },
  "timestamp": 1705924800000
}
```

### 3. å…¨å±€å¼‚å¸¸å¤„ç†

ä½¿ç”¨ `@RestControllerAdvice` ç»Ÿä¸€æ•è·å¼‚å¸¸ï¼Œé¿å…åœ¨æ¯ä¸ªæ¥å£é‡å¤å¤„ç†ã€‚

---

## ğŸ“ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **é›†æˆ Spring Security**
   - å®ç° JWT Token è®¤è¯
   - æ·»åŠ ç”¨æˆ·æƒé™ç®¡ç†

2. **æ·»åŠ  Redis ç¼“å­˜**
   - ç¼“å­˜åŠ å¯†è´§å¸æ±‡ç‡æ•°æ®
   - å‡å°‘ API è°ƒç”¨æ¬¡æ•°

3. **å¯†ç åŠ å¯†**
   - ä½¿ç”¨ BCrypt åŠ å¯†å­˜å‚¨ç”¨æˆ·å¯†ç 

4. **é›†æˆ Swagger**
   - è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£

5. **å•å…ƒæµ‹è¯•**
   - ä½¿ç”¨ JUnit 5 å’Œ Mockito ç¼–å†™æµ‹è¯•ç”¨ä¾‹

---

## ğŸ“ å¸®åŠ©

- ğŸ“– **è¯¦ç»†æ–‡æ¡£**ï¼šæŸ¥çœ‹ `README.md`
- ğŸ§ª **API æµ‹è¯•**ï¼šæŸ¥çœ‹ `API_TEST.md`
- ğŸ’¬ **ä»£ç æ³¨é‡Š**ï¼šæ‰€æœ‰ä»£ç éƒ½æœ‰è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š

---

## âœ… éªŒè¯æ¸…å•

å¯åŠ¨æˆåŠŸåï¼Œç¡®è®¤ä»¥ä¸‹å†…å®¹ï¼š

- [x] é¡¹ç›®æˆåŠŸå¯åŠ¨ï¼Œæ§åˆ¶å°æ˜¾ç¤ºå¯åŠ¨æˆåŠŸä¿¡æ¯
- [x] è®¿é—® `http://localhost:8080/market/rates` èƒ½è·å–åˆ°åŠ å¯†è´§å¸æ±‡ç‡
- [x] è®¿é—® `http://localhost:8080/user/1` èƒ½æŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯
- [x] æ•°æ®åº“ä¸­æœ‰ 4 æ¡æµ‹è¯•ç”¨æˆ·æ•°æ®
- [x] æ§åˆ¶å°æœ‰ OkHttp çš„è¯¦ç»†è¯·æ±‚æ—¥å¿—

å…¨éƒ¨å®Œæˆåï¼Œä½ çš„é¡¹ç›®å°±æ­£å¼è¿è¡Œèµ·æ¥äº†ï¼ğŸ‰

---

**ç¥ä½ å¼€å‘é¡ºåˆ©ï¼** ğŸš€
